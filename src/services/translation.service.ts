import { Injectable, signal } from '@angular/core';

@Injectable({
  providedIn: 'root'
})
export class TranslationService {
  language = signal<'en' | 'es'>('en');

  private translations: Record<string, Record<string, string>> = {
    en: {
      'header.title': 'SaborScout',
      'header.producer': 'Producer Mode',
      'tabs.scan': 'Scan',
      'tabs.search': 'Search',
      'tabs.favorites': 'Favorites',
      'tabs.education': 'Learn',
      'tabs.events': 'Events',
      'scanner.scanBeer': 'Scan Beer Label',
      'scanner.scanning': 'Scanning...',
      'scanner.submitting': 'Submitting...',
      'scanner.errorReadFile': 'Error reading file.',
      'scanner.errorUnknown': 'Could not identify this beer. Please help us by adding it.',
      'scanner.errorUnknownScan': 'An unknown error occurred during scanning.',
      'scanner.successSubmission': 'Thank you! Your contribution has been submitted.',
      'scanner.errorSubmission': 'There was an error submitting your contribution.',
      'scanner.errorMissingData': 'Beer name and brewery are required.',
      'scanner.errorMissingImage': 'Image data is missing for contribution.',
      'scanner.scanAnother': 'Scan Another Beer',
      'scanner.form.title': 'Add New Beer',
      'scanner.form.name': 'Beer Name',
      'scanner.form.brewery': 'Brewery',
      'scanner.form.style': 'Style',
      'scanner.form.abv': 'ABV (%)',
      'scanner.form.ibu': 'IBU',
      'scanner.form.description': 'Description',
      'scanner.form.tastingNotes': 'Tasting Notes (comma-separated)',
      'scanner.form.tastingNotesPlaceholder': 'e.g., citrus, pine, caramel',
      'scanner.form.required': '*',
      'scanner.form.cancel': 'Cancel',
      'scanner.form.submit': 'Submit',
      'scanner.form.submitting': 'Submitting...',
      'beerDetails.title': 'Beer Details',
      'beerDetails.addFavorite': 'Add to favorites',
      'beerDetails.removeFavorite': 'Remove from favorites',
      'beerDetails.style': 'Style',
      'beerDetails.sensoryAnalysis': 'Sensory Analysis',
      'beerDetails.flavorAroma': 'Flavor & Aroma',
      'beerDetails.commonDefects.title': 'Common Defects',
      'beerDetails.commonDefects.description': 'AI analysis can help identify potential off-flavors like Diacetyl (buttery) or DMS (cooked corn).',
      'beerDetails.rate.title': 'Rate This Beer',
      'beerDetails.rate.setRating': 'Set rating to {stars} stars',
      'beerDetails.rate.saved': 'Your rating has been saved!',
      'beerDetails.pair': 'Find Food Pairings',
      'beerDetails.pairings.loading': 'Finding pairings...',
      'beerDetails.pairings.title': 'Food Pairings',
      'beerDetails.pairings.error': 'Could not fetch food pairings. Please try again.',
      'beerDetails.share': 'Share',
      'beerDetails.copied': 'Copied!',
      'beerDetails.shareText': 'I\'m checking out {name} by {brewery} on SaborScout!',
      'beerSearch.placeholder': 'Search by name or style...',
      'beerSearch.errorNotFound': 'No beers found matching your search.',
      'beerSearch.errorUnknown': 'An error occurred while searching.',
      'beerSearch.filters.title': 'Filters',
      'beerSearch.filters.ratingTitle': 'Minimum Rating',
      'beerSearch.filters.abvTitle': 'ABV (%) Range',
      'beerSearch.filters.abvMin': 'Min',
      'beerSearch.filters.abvMax': 'Max',
      'beerSearch.filters.clear': 'Clear Filters',
      'beerSearch.noResultsWithFilters': 'No beers match your current filters.',
      'favorites.title': 'My Favorites',
      'favorites.empty.title': 'No Favorites Yet',
      'favorites.empty.description': 'You can add beers to your favorites from their details page.',
      'favorites.back': 'Back to Favorites',
      'education.title': 'Beer School',
      'education.description': 'Ask anything about beer, from brewing processes to style histories.',
      'education.placeholder': 'e.g., "What are the different types of hops?"',
      'education.ask': 'Ask',
      'education.loading': 'Brewing up some knowledge...',
      'education.error': 'Sorry, I couldn\'t find an answer. Please try a different question.',
      'education.topics.defects': 'Common Beer Defects',
      'education.topics.ibu': 'What is IBU?',
      'education.topics.aleLager': 'Ale vs. Lager',
      'education.topics.mouthfeel': 'What is Mouthfeel?',
      'education.topics.hops': 'Types of Hops',
      'localEvents.title': 'Local Beer Events',
      'localEvents.placeholder': 'Enter your city or zip code',
      'localEvents.find': 'Find Events',
      'localEvents.loading': 'Searching for events...',
      'localEvents.error': 'Could not find events. Please try again.',
      'localEvents.notFound': 'No local beer events found for your location.',
      'localEvents.moreInfo': 'More Info',
      'producerDashboard.nav.home': 'Home',
      'producerDashboard.nav.consumer': 'Consumer',
      'producerDashboard.nav.profile': 'Profile',
      'producerDashboard.summaryTitle': 'Brewery Summary',
      'producerDashboard.productionStatus': 'Production Status',
      'producerDashboard.inProgress': 'In Progress',
      'producerDashboard.qualityAlerts': 'Quality Alerts',
      'producerDashboard.recipePerformance': 'Recipe Performance',
      'producerDashboard.quickAccessTitle': 'Producer Tools',
      'tabs.optimize': 'Recipe Optimizer',
      'tabs.qc': 'Quality Control',
      'tabs.marketing': 'Marketing Assist',
      'tabs.predictive': 'Predictive Analytics',
      'tabs.integrations': 'Integrations',
      'recipeOptimizer.title': 'Recipe Optimizer',
      'recipeOptimizer.description': 'Generate a new beer recipe based on your desired parameters.',
      'recipeOptimizer.style': 'Beer Style',
      'recipeOptimizer.stylePlaceholder': 'e.g., West Coast IPA',
      'recipeOptimizer.abv': 'Target ABV (%)',
      'recipeOptimizer.abvPlaceholder': 'e.g., 6.8',
      'recipeOptimizer.ibu': 'Target IBU',
      'recipeOptimizer.ibuPlaceholder': 'e.g., 60',
      'recipeOptimizer.flavor': 'Desired Flavor Profile',
      'recipeOptimizer.flavorPlaceholder': 'e.g., "hoppy, citrus notes, dry finish"',
      'recipeOptimizer.generate': 'Generate Recipe',
      'recipeOptimizer.error': 'Could not generate recipe. Please adjust parameters and try again.',
      'recipeOptimizer.results.maltBill': 'Malt Bill',
      'recipeOptimizer.results.hopSchedule': 'Hop Schedule',
      'recipeOptimizer.results.yeast': 'Yeast',
      'recipeOptimizer.results.instructions': 'Brewing Instructions',
      'qualityControl.rawMaterialsTitle': 'Raw Materials Analysis',
      'qualityControl.finalProductTitle': 'Final Product Analysis',
      'qualityControl.analysisTypes.hops.title': 'Hop Quality Scan',
      'qualityControl.analysisTypes.hops.description': 'Analyze alpha acids and oil content. (Coming soon)',
      'qualityControl.analysisTypes.malt.title': 'Malt Consistency Check',
      'qualityControl.analysisTypes.malt.description': 'Check for diastatic power and color consistency. (Coming soon)',
      'qualityControl.analysisTypes.turbidity.title': 'Turbidity & Clarity Analysis',
      'qualityControl.analysisTypes.turbidity.description': 'Upload an image to analyze beer clarity and haze.',
      'qualityControl.analysisTypes.visual_defects.title': 'Visual Defect Detection',
      'qualityControl.analysisTypes.visual_defects.description': 'Identify floaters, sediment, or other visual issues.',
      'qualityControl.upload': 'Upload Image',
      'qualityControl.uploadNew': 'Upload New Image',
      'qualityControl.loading': 'Analyzing image...',
      'qualityControl.error': 'An error occurred during analysis.',
      'qualityControl.report': 'Analysis Report',
      'marketingAssist.title': 'Marketing Assistant',
      'marketingAssist.description': 'Generate marketing copy for your new beer based on its characteristics.',
      'marketingAssist.beerName': 'Beer Name',
      'marketingAssist.beerNamePlaceholder': 'e.g., "Cosmic Haze"',
      'marketingAssist.style': 'Style',
      'marketingAssist.stylePlaceholder': 'e.g., "Hazy IPA"',
      'marketingAssist.tastingNotes': 'Tasting Notes',
      'marketingAssist.tastingNotesPlaceholder': 'e.g., "mango, pineapple, soft bitterness"',
      'marketingAssist.targetAudience': 'Target Audience',
      'marketingAssist.targetAudiencePlaceholder': 'e.g., "Craft beer enthusiasts, millennials"',
      'marketingAssist.generate': 'Generate Copy',
      'marketingAssist.error': 'Could not generate marketing copy. Please try again.',
      'marketingAssist.results.title': 'Generated Marketing Copy',
      'predictiveAnalytics.selectBatch': 'Select Batch',
      'predictiveAnalytics.loading': 'Loading analytics...',
      'predictiveAnalytics.flavorEvolution.title': 'Flavor Evolution Prediction',
      'predictiveAnalytics.flavorEvolution.timeframe': 'over next 28 days',
      'predictiveAnalytics.shelfLife.title': 'Shelf Life Prediction',
      'predictiveAnalytics.shelfLife.timeframe': 'from last analysis',
      'predictiveAnalytics.microbiologicalRisks.title': 'Microbiological Risks',
      'predictiveAnalytics.microbiologicalRisks.timeframe': 'over next 28 days',
      'predictiveAnalytics.charts.day': 'Day',
      'predictiveAnalytics.charts.week': 'Week',
      'integrations.title': 'Connect your BMS',
      'integrations.description': 'Connect your existing brewery management software to Sabor Scout to sync production, inventory, and recipe data.',
      'integrations.managementSoftware': 'Management Software',
    },
    es: {
        'header.title': 'SaborScout',
        'header.producer': 'Modo Productor',
        'tabs.scan': 'Escanear',
        'tabs.search': 'Buscar',
        'tabs.favorites': 'Favoritos',
        'tabs.education': 'Aprender',
        'tabs.events': 'Eventos',
        'scanner.scanBeer': 'Escanear Etiqueta',
        'scanner.scanning': 'Escaneando...',
        'scanner.submitting': 'Enviando...',
        'scanner.errorReadFile': 'Error al leer el archivo.',
        'scanner.errorUnknown': 'No se pudo identificar esta cerveza. Por favor, ayúdanos agregándola.',
        'scanner.errorUnknownScan': 'Ocurrió un error desconocido durante el escaneo.',
        'scanner.successSubmission': '¡Gracias! Tu contribución ha sido enviada.',
        'scanner.errorSubmission': 'Hubo un error al enviar tu contribución.',
        'scanner.errorMissingData': 'El nombre de la cerveza y la cervecería son obligatorios.',
        'scanner.errorMissingImage': 'Faltan los datos de la imagen para la contribución.',
        'scanner.scanAnother': 'Escanear Otra Cerveza',
        'scanner.form.title': 'Añadir Nueva Cerveza',
        'scanner.form.name': 'Nombre de la Cerveza',
        'scanner.form.brewery': 'Cervecería',
        'scanner.form.style': 'Estilo',
        'scanner.form.abv': 'ABV (%)',
        'scanner.form.ibu': 'IBU',
        'scanner.form.description': 'Descripción',
        'scanner.form.tastingNotes': 'Notas de Cata (separadas por coma)',
        'scanner.form.tastingNotesPlaceholder': 'ej., cítrico, pino, caramelo',
        'scanner.form.required': '*',
        'scanner.form.cancel': 'Cancelar',
        'scanner.form.submit': 'Enviar',
        'scanner.form.submitting': 'Enviando...',
        'beerDetails.title': 'Detalles de Cerveza',
        'beerDetails.addFavorite': 'Añadir a favoritos',
        'beerDetails.removeFavorite': 'Quitar de favoritos',
        'beerDetails.style': 'Estilo',
        'beerDetails.sensoryAnalysis': 'Análisis Sensorial',
        'beerDetails.flavorAroma': 'Sabor y Aroma',
        'beerDetails.commonDefects.title': 'Defectos Comunes',
        'beerDetails.commonDefects.description': 'El análisis por IA puede ayudar a identificar posibles sabores no deseados como Diacetilo (mantecoso) o DMS (maíz cocido).',
        'beerDetails.rate.title': 'Califica Esta Cerveza',
        'beerDetails.rate.setRating': 'Calificar con {stars} estrellas',
        'beerDetails.rate.saved': '¡Tu calificación ha sido guardada!',
        'beerDetails.pair': 'Buscar Maridajes',
        'beerDetails.pairings.loading': 'Buscando maridajes...',
        'beerDetails.pairings.title': 'Maridajes',
        'beerDetails.pairings.error': 'No se pudieron obtener los maridajes. Por favor, inténtalo de nuevo.',
        'beerDetails.share': 'Compartir',
        'beerDetails.copied': '¡Copiado!',
        'beerDetails.shareText': '¡Estoy viendo {name} de {brewery} en SaborScout!',
        'beerSearch.placeholder': 'Buscar por nombre o estilo...',
        'beerSearch.errorNotFound': 'No se encontraron cervezas que coincidan con tu búsqueda.',
        'beerSearch.errorUnknown': 'Ocurrió un error al buscar.',
        'beerSearch.filters.title': 'Filtros',
        'beerSearch.filters.ratingTitle': 'Calificación Mínima',
        'beerSearch.filters.abvTitle': 'Rango de ABV (%)',
        'beerSearch.filters.abvMin': 'Mín',
        'beerSearch.filters.abvMax': 'Máx',
        'beerSearch.filters.clear': 'Limpiar Filtros',
        'beerSearch.noResultsWithFilters': 'Ninguna cerveza coincide con tus filtros actuales.',
        'favorites.title': 'Mis Favoritos',
        'favorites.empty.title': 'Aún no hay favoritos',
        'favorites.empty.description': 'Puedes añadir cervezas a tus favoritos desde su página de detalles.',
        'favorites.back': 'Volver a Favoritos',
        'education.title': 'Escuela Cervecera',
        'education.description': 'Pregunta cualquier cosa sobre cerveza, desde procesos de elaboración hasta historias de estilos.',
        'education.placeholder': 'ej., "¿Cuáles son los diferentes tipos de lúpulo?"',
        'education.ask': 'Preguntar',
        'education.loading': 'Cocinando un poco de conocimiento...',
        'education.error': 'Lo siento, no pude encontrar una respuesta. Por favor, intenta una pregunta diferente.',
        'education.topics.defects': 'Defectos Comunes de la Cerveza',
        'education.topics.ibu': '¿Qué es IBU?',
        'education.topics.aleLager': 'Ale vs. Lager',
        'education.topics.mouthfeel': '¿Qué es la Sensación en Boca?',
        'education.topics.hops': 'Tipos de Lúpulo',
        'localEvents.title': 'Eventos Cerveceros Locales',
        'localEvents.placeholder': 'Ingresa tu ciudad o código postal',
        'localEvents.find': 'Buscar Eventos',
        'localEvents.loading': 'Buscando eventos...',
        'localEvents.error': 'No se pudieron encontrar eventos. Por favor, inténtalo de nuevo.',
        'localEvents.notFound': 'No se encontraron eventos cerveceros locales para tu ubicación.',
        'localEvents.moreInfo': 'Más Información',
        'producerDashboard.nav.home': 'Inicio',
        'producerDashboard.nav.consumer': 'Consumidor',
        'producerDashboard.nav.profile': 'Perfil',
        'producerDashboard.summaryTitle': 'Resumen de Cervecería',
        'producerDashboard.productionStatus': 'Estado de Producción',
        'producerDashboard.inProgress': 'En Progreso',
        'producerDashboard.qualityAlerts': 'Alertas de Calidad',
        'producerDashboard.recipePerformance': 'Rendimiento de Receta',
        'producerDashboard.quickAccessTitle': 'Herramientas de Productor',
        'tabs.optimize': 'Optimizador de Recetas',
        'tabs.qc': 'Control de Calidad',
        'tabs.marketing': 'Asistente de Marketing',
        'tabs.predictive': 'Análisis Predictivo',
        'tabs.integrations': 'Integraciones',
        'recipeOptimizer.title': 'Optimizador de Recetas',
        'recipeOptimizer.description': 'Genera una nueva receta de cerveza basada en los parámetros deseados.',
        'recipeOptimizer.style': 'Estilo de Cerveza',
        'recipeOptimizer.stylePlaceholder': 'ej., West Coast IPA',
        'recipeOptimizer.abv': 'ABV Objetivo (%)',
        'recipeOptimizer.abvPlaceholder': 'ej., 6.8',
        'recipeOptimizer.ibu': 'IBU Objetivo',
        'recipeOptimizer.ibuPlaceholder': 'ej., 60',
        'recipeOptimizer.flavor': 'Perfil de Sabor Deseado',
        'recipeOptimizer.flavorPlaceholder': 'ej., "lupulado, notas cítricas, final seco"',
        'recipeOptimizer.generate': 'Generar Receta',
        'recipeOptimizer.error': 'No se pudo generar la receta. Ajusta los parámetros e inténtalo de nuevo.',
        'recipeOptimizer.results.maltBill': 'Macerado',
        'recipeOptimizer.results.hopSchedule': 'Calendario de Lúpulos',
        'recipeOptimizer.results.yeast': 'Levadura',
        'recipeOptimizer.results.instructions': 'Instrucciones de Elaboración',
        'qualityControl.rawMaterialsTitle': 'Análisis de Materias Primas',
        'qualityControl.finalProductTitle': 'Análisis del Producto Final',
        'qualityControl.analysisTypes.hops.title': 'Escaneo de Calidad de Lúpulo',
        'qualityControl.analysisTypes.hops.description': 'Analizar ácidos alfa y contenido de aceite. (Próximamente)',
        'qualityControl.analysisTypes.malt.title': 'Verificación de Consistencia de Malta',
        'qualityControl.analysisTypes.malt.description': 'Verificar poder diastático y consistencia de color. (Próximamente)',
        'qualityControl.analysisTypes.turbidity.title': 'Análisis de Turbidez y Claridad',
        'qualityControl.analysisTypes.turbidity.description': 'Sube una imagen para analizar la claridad y turbidez de la cerveza.',
        'qualityControl.analysisTypes.visual_defects.title': 'Detección de Defectos Visuales',
        'qualityControl.analysisTypes.visual_defects.description': 'Identificar partículas, sedimentos u otros problemas visuales.',
        'qualityControl.upload': 'Subir Imagen',
        'qualityControl.uploadNew': 'Subir Nueva Imagen',
        'qualityControl.loading': 'Analizando imagen...',
        'qualityControl.error': 'Ocurrió un error durante el análisis.',
        'qualityControl.report': 'Reporte de Análisis',
        'marketingAssist.title': 'Asistente de Marketing',
        'marketingAssist.description': 'Genera textos de marketing para tu nueva cerveza basados en sus características.',
        'marketingAssist.beerName': 'Nombre de la Cerveza',
        'marketingAssist.beerNamePlaceholder': 'ej., "Cosmic Haze"',
        'marketingAssist.style': 'Estilo',
        'marketingAssist.stylePlaceholder': 'ej., "Hazy IPA"',
        'marketingAssist.tastingNotes': 'Notas de Cata',
        'marketingAssist.tastingNotesPlaceholder': 'ej., "mango, piña, amargor suave"',
        'marketingAssist.targetAudience': 'Público Objetivo',
        'marketingAssist.targetAudiencePlaceholder': 'ej., "Entusiastas de la cerveza artesanal, millennials"',
        'marketingAssist.generate': 'Generar Texto',
        'marketingAssist.error': 'No se pudo generar el texto de marketing. Por favor, inténtalo de nuevo.',
        'marketingAssist.results.title': 'Texto de Marketing Generado',
        'predictiveAnalytics.selectBatch': 'Seleccionar Lote',
        'predictiveAnalytics.loading': 'Cargando análisis...',
        'predictiveAnalytics.flavorEvolution.title': 'Predicción de Evolución del Sabor',
        'predictiveAnalytics.flavorEvolution.timeframe': 'en los próximos 28 días',
        'predictiveAnalytics.shelfLife.title': 'Predicción de Vida Útil',
        'predictiveAnalytics.shelfLife.timeframe': 'desde el último análisis',
        'predictiveAnalytics.microbiologicalRisks.title': 'Riesgos Microbiológicos',
        'predictiveAnalytics.microbiologicalRisks.timeframe': 'en los próximos 28 días',
        'predictiveAnalytics.charts.day': 'Día',
        'predictiveAnalytics.charts.week': 'Semana',
        'integrations.title': 'Conecta tu BMS',
        'integrations.description': 'Conecta tu software de gestión de cervecerías existente a Sabor Scout para sincronizar datos de producción, inventario y recetas.',
        'integrations.managementSoftware': 'Software de Gestión',
    }
  };

  setLanguage(lang: 'en' | 'es'): void {
    this.language.set(lang);
  }

  translate(key: string, params?: Record<string, string | number>): string {
    const lang = this.language();
    let translation = this.translations[lang]?.[key] || key;

    if (params) {
      Object.keys(params).forEach(paramKey => {
        translation = translation.replace(`{${paramKey}}`, String(params[paramKey]));
      });
    }

    return translation;
  }
}
